<xml>

    <files id='haxe'>

        <compilerflag value='-I${LINC_LUA_PATH}/linc/'/>
        <compilerflag value='-I${LINC_LUA_PATH}/compat/'/>
        <compilerflag value='-I${LINC_LUA_PATH}lib/luau/VM/include/'/>
        <compilerflag value='-I${LINC_LUA_PATH}lib/luau/Compiler/include/'/>
        <!-- Android 特殊路径：保留两种写法以兼容不同构建系统对路径的解析 -->
        <file name='${LINC_LUA_PATH}/linc/linc_lua.cpp' if="android"/>
        <file name='${LINC_LUA_PATH}linc/linc_lua.cpp' unless="android"/>

    </files>

    <files id="__main__">
        <compilerflag value='-I${LINC_LUA_PATH}/linc/'/>
        <compilerflag value='-I${LINC_LUA_PATH}/compat/'/>
        <compilerflag value='-I${LINC_LUA_PATH}lib/luau/VM/include/'/>
        <compilerflag value='-I${LINC_LUA_PATH}lib/luau/Compiler/include/'/>
    </files>

    <section id="vars">
        <set name="NO_PRECOMPILED_HEADERS" value="1" />
    </section>

    <!--
      Updated library layout to match the GitHub Actions artifacts layout used in the workflow:
        - lib/luau/lib/windows-x64/
        - lib/luau/lib/linux-x64/
        - lib/luau/lib/macos-x64/
        - lib/luau/lib/macos-arm64/
        - lib/luau/lib/android/armv7/        <-- 32-bit ARM renamed to armv7
        - lib/luau/lib/android/arm64-v8a/
        - lib/luau/lib/android/x86/
        - lib/luau/lib/android/x86_64/
        - lib/luau/lib/ios/
      This makes the hxcpp/haxe build pick up prebuilt libs generated by the workflow create-release step.
    -->
    <target id="haxe">

        <section if="windows" unless="mingw">
            <!-- Windows x64 (workflow produces windows-x64) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.VM.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Common.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Ast.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Compiler.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />

            <!-- Windows arm64 (if you later add windows-arm64 artifacts) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.VM.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Common.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Ast.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Compiler.lib' if='HXCPP_ARM64' />

            <!-- Windows 32-bit (legacy) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.VM.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Common.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Ast.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Compiler.lib' if='HXCPP_M32' />
        </section>

        <section if="mingw">
            <!-- MinGW static libs (map to windows-x64/windows-arm64 structure where appropriate) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/libluauvm.a' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/libluaucompiler.a' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/libluauvm.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/libluaucompiler.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/libluauvm.a' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/libluaucompiler.a' if='HXCPP_M32' />
        </section>

        <section if="linux">
            <!-- Linux x64 (workflow produces linux-x64) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/linux-x64/libluauvm.a' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/linux-x64/libluaucompiler.a' if='HXCPP_M64' unless='HXCPP_ARM64' />

            <!-- Linux arm64 -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/linux-arm64/libluauvm.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/linux-arm64/libluaucompiler.a' if='HXCPP_ARM64' />
        </section>

        <section if="mac">
            <!-- macOS: match workflow naming -> macos-x64 and macos-arm64 -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/macos-x64/libluauvm.a' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/macos-x64/libluaucompiler.a' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/macos-arm64/libluauvm.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/macos-arm64/libluaucompiler.a' if='HXCPP_ARM64' />
        </section>

        <section if="android">
            <!-- Android: per-ABI directories produced by the workflow (now using armv7 for 32-bit ARM) -->
            <!-- armv7 (32-bit ARM) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/armv7/libluauvm.a' if='HXCPP_ARMV7' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/armv7/libluaucompiler.a' if='HXCPP_ARMV7' />

            <!-- arm64-v8a (64-bit ARM) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/arm64-v8a/libluauvm.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/arm64-v8a/libluaucompiler.a' if='HXCPP_ARM64' />

            <!-- x86 (32-bit Intel) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86/libluauvm.a' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86/libluaucompiler.a' if='HXCPP_M32' />

            <!-- x86_64 (64-bit Intel) -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86_64/libluauvm.a' if='HXCPP_M64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86_64/libluaucompiler.a' if='HXCPP_M64' />

            <!--
              Fallback (flattened) path kept for compatibility with current create-release copy behaviour
              (the workflow currently flattens android artifacts into lib/android/). Uncomment if you rely on flattened names.
            -->
            <!--
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/libluauvm.a' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/libluaucompiler.a' />
            -->
        </section>

        <section if="ios">
            <!-- iOS: workflow copies iphoneos / iphonesimulator artifacts into lib/luau/lib/ios/ -->
            <section if="iphoneos">
                <lib name='${LINC_LUA_PATH}/lib/luau/lib/ios/libluauvm.iphoneos-64.a' if='HXCPP_ARM64' />
                <lib name='${LINC_LUA_PATH}/lib/luau/lib/ios/libluaucompiler.iphoneos-64.a' if='HXCPP_ARM64' />
            </section>
            <section if="iphonesim">
                <lib name='${LINC_LUA_PATH}/lib/luau/lib/ios/libluauvm.iphonesim-64.a' if='HXCPP_ARM64 || HXCPP_M64' />
                <lib name='${LINC_LUA_PATH}/lib/luau/lib/ios/libluaucompiler.iphonesim-64.a' if='HXCPP_ARM64 || HXCPP_M64' />
            </section>
        </section>

        <flag value="-fstack-protector" if="mingw"/>
    </target>

    <target id="__main__">
        <section if="windows" unless="mingw">
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.VM.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Common.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Ast.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Compiler.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.VM.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Common.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Ast.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Compiler.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.VM.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Common.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Ast.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Compiler.lib' if='HXCPP_M32' />
        </section>

        <section if="android">
            <!-- Mirror of per-ABI android libs for __main__ linkage -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/armv7/libluauvm.a' if='HXCPP_ARMV7' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/armv7/libluaucompiler.a' if='HXCPP_ARMV7' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/arm64-v8a/libluauvm.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/arm64-v8a/libluaucompiler.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86/libluauvm.a' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86/libluaucompiler.a' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86_64/libluauvm.a' if='HXCPP_M64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86_64/libluaucompiler.a' if='HXCPP_M64' />
        </section>

        <flag value="-fstack-protector" if="mingw"/>
    </target>

    <target id="__lib__">
        <section if="windows" unless="mingw">
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.VM.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Common.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Ast.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-x64/Luau.Compiler.lib' if='HXCPP_M64' unless='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.VM.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Common.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Ast.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows-arm64/Luau.Compiler.lib' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.VM.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Common.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Ast.lib' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/windows/Luau.Compiler.lib' if='HXCPP_M32' />
        </section>

        <section if="android">
            <!-- Mirror for __lib__ as well -->
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/armv7/libluauvm.a' if='HXCPP_ARMV7' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/armv7/libluaucompiler.a' if='HXCPP_ARMV7' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/arm64-v8a/libluauvm.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/arm64-v8a/libluaucompiler.a' if='HXCPP_ARM64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86/libluauvm.a' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86/libluaucompiler.a' if='HXCPP_M32' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86_64/libluauvm.a' if='HXCPP_M64' />
            <lib name='${LINC_LUA_PATH}/lib/luau/lib/android/x86_64/libluaucompiler.a' if='HXCPP_M64' />
        </section>

        <flag value="-fstack-protector" if="mingw"/>
    </target>

</xml>
